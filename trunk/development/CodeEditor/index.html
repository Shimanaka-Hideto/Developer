<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" keyword="CodeEditorPHP">
        <title>Code Editor -PHP-</title>
        <link rel="stylesheet" href="lib/codemirror.css">
        <link rel="stylesheet" href="common/css/index.css">
        <script src="lib/codemirror.js"></script>
        <script src="addon/edit/matchbrackets.js"></script>
        <script src="common/htmlmixed/htmlmixed.js"></script>
        <script src="common/xml/xml.js"></script>
        <script src="common/javascript/javascript.js"></script>
        <script src="common/css/css.js"></script>
        <script src="common/clike/clike.js"></script>
        <script src="common/js/php.js"></script>
        <link rel="stylesheet" href="theme/elegant.css">
        <style type="text/css">.CodeMirror {border-top: 1px solid  black; border-bottom: 1px solid black;}</style>
    </head>
    <header><h2>Code Editor -PHP-</h2></header>
    <body>
        <div id="container">
            <section id="left">
                <!-- Text Area -->
                <div id="title_editor">エディット画面</div>
                <form><textarea id="code" name="code">
                    <!DOCTYPE html>
                    <html lang="ja">
                        <meta charset="UTF-8">
                        <?php
                            // 名前の変数
                            $name = "テスト太郎";
    
                            // 年齢用の変数
                            $age = 20;
    
                            // 勤務先の変数
                            $company = "PHP株式会社";
                        ?>
                        <h2>Hello PHP</h2>

                        <?php
                            print $name . "さんの年齢は" . $age . "歳です。";
                        ?>
                        <br>
                        <?php
                            print $company . "の社員です。";
                        ?>
                    </html>
                </textarea></form>
                <!-- Text Area End -->
            </section>
            <div id="preview-container">
                <iframe id="preview"></iframe>
                <script>
                    var delay;
                    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
                        lineNumbers: true,
                        matchBrackets: true,
                        mode: {
                            name: "application/x-httpd-php",
                            startOpen: true
                        },
                        indentUnit: 4,
                        indentWithTabs: true,
                        enterMode: "keep",
                        tabMode: "shift",
                        theme: "elegant"
                    });

                    editor.on("change", function() {
                        clearTimeout(delay);
                        delay = setTimeout(updatePreview, 0);
                    });
                    
                    function updatePreview() {
                        var previewFrame = document.getElementById('preview');
                        var preview =  previewFrame.contentDocument ||  previewFrame.contentWindow.document;
                        preview.open();
                        preview.write(editor.getValue());
                        preview.close();
                    }
                    setTimeout(updatePreview, 0);
                    editor.save();
                </script>
            </div>
        </div>
    </body>
</html>